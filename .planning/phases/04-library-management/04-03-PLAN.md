---
phase: 04-library-management
plan: 03
type: execute
---

<objective>
Build library display page with streaming provider information.

Purpose: Show the household's tracked titles with artwork and streaming availability.
Output: Library page with filterable grid and provider logos on title cards.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plans in this phase:
@.planning/phases/04-library-management/04-01-SUMMARY.md
@.planning/phases/04-library-management/04-02-SUMMARY.md

# Components created:
@web/components/title-card.tsx

# TMDB provider integration:
@web/lib/tmdb/providers.ts
@web/lib/tmdb/details.ts
@web/lib/tmdb/images.ts

# Library service:
@web/lib/services/library.ts

**Tech stack:** Next.js 16, TanStack Query, shadcn/ui, Tailwind
**Patterns:** Server/client component split, service layer for data access
**Decisions:**
- Default to US region for watch providers
- Return null for 404s
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create library page with title grid</name>
  <files>web/app/app/library/page.tsx, web/app/app/library/library-client.tsx</files>
  <action>
Create library page at `/app/library`:

**page.tsx (server component):**
- Wrapper with ProfileGuard
- Render LibraryClient

**library-client.tsx (client component):**
1. Fetch library titles on mount using `/api/library` route (create below)
2. State: titles array, loading, filter (all | tv | movie)
3. Header: "My Library" title + filter tabs (All, TV Shows, Movies)
4. Empty state: "No titles in your library. Search to add some!" with link to /app/library/search
5. Grid: Same responsive grid as search (3/2/1 cols)
6. Each title: Use TitleCard with onRemove handler

**API route web/app/api/library/route.ts:**
- GET: Returns library with TMDB metadata
- Query household's tracked_titles
- For each title, fetch TMDB details (getTVDetails or getMovieDetails) to get poster_path, name/title
- Return enriched objects: { id, tmdbId, mediaType, title, posterPath, year }
- Use Promise.all for parallel TMDB fetches (batch of 20 max to avoid rate limits)

**Remove action:**
- Call DELETE /api/library/[id] route (create below)
- On success, remove from local state
- Confirm with AlertDialog before delete

**API route web/app/api/library/[id]/route.ts:**
- DELETE: Call removeTitle service
- Return success/error

Import AlertDialog from shadcn for delete confirmation.
  </action>
  <verify>
`cd web && npm run build` passes
  </verify>
  <done>Library page shows tracked titles in grid with filter and remove functionality</done>
</task>

<task type="auto">
  <name>Task 2: Add streaming provider display</name>
  <files>web/components/title-card.tsx, web/components/provider-logos.tsx</files>
  <action>
Enhance TitleCard to show streaming providers:

**New component web/components/provider-logos.tsx:**
Props: `{ providers: { name: string; logoPath: string }[] }`
- Display up to 4 provider logos in a row
- Use getProviderLogoUrl for logo URLs
- Small size (24x24px)
- Tooltip with provider name on hover

**Update TitleCard props:**
Add optional `providers?: { name: string; logoPath: string }[]`

**Update TitleCard render:**
- Below the year/type row, show ProviderLogos if providers array provided
- Subtle styling that doesn't overwhelm the card

**Update library API route:**
- After fetching TMDB details, also fetch watch providers
- getTVWatchProviders or getMovieWatchProviders
- Extract flatrate (subscription streaming) providers
- Add to response: `providers: [{ name, logoPath }]`

Only fetch providers for the first 20 titles to avoid slow page loads. For larger libraries, providers can load lazily later (out of scope for this plan).
  </action>
  <verify>
`cd web && npx tsc --noEmit` passes
  </verify>
  <done>Library titles show streaming provider logos when available</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Library page with title grid, filtering, remove action, and streaming providers</what-built>
  <how-to-verify>
    1. Run: `cd web && npm run dev`
    2. Visit: http://localhost:3000/app/library
    3. Verify: Previously added titles appear in grid
    4. Verify: Posters load (or fallback shows)
    5. Click filter tabs (All, TV Shows, Movies)
    6. Verify: Grid filters correctly
    7. Hover over a title - verify year and media type visible
    8. Look for streaming provider logos under titles (Netflix, Hulu, etc.)
    9. Click Remove on a title
    10. Verify: Confirmation dialog appears
    11. Confirm deletion
    12. Verify: Title removed from grid
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd web && npm run build` succeeds
- [ ] Library page loads tracked titles
- [ ] Filter tabs work correctly
- [ ] Remove action works with confirmation
- [ ] Provider logos display for streaming titles
- [ ] Empty state shows when library is empty
</verification>

<success_criteria>

- Library page accessible at /app/library
- Titles display with posters and metadata
- Filter by media type works
- Remove from library works
- Streaming providers shown where available
- Human verification approved
- Phase 4 complete
</success_criteria>

<output>
After completion, create `.planning/phases/04-library-management/04-03-SUMMARY.md` with:
- Full phase summary (Phase 4 complete)
- All files created across all 3 plans
- Key decisions made
- Ready for Phase 5 (Schedule System)
</output>
