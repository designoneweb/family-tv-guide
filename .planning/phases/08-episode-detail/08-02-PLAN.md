---
phase: 08-episode-detail
plan: 02
type: execute
---

<objective>
Create episode detail page with full overview, cast/guest stars, and mark watched action.

Purpose: Allow users to see comprehensive episode information and mark episodes as watched from the detail view.
Output: Episode detail page at /app/show/[id]/season/[seasonNumber]/episode/[episodeNumber] with cast display and mark watched.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context:
@.planning/phases/08-episode-detail/08-01-SUMMARY.md
@.planning/phases/07-episode-grid/07-01-SUMMARY.md
@.planning/phases/06-progress-tracking/06-02-SUMMARY.md

# Key files to reference:
@web/app/app/show/[id]/show-client.tsx
@web/components/episode-tile.tsx
@web/lib/tmdb/types.ts
@web/lib/tmdb/details.ts
@web/lib/tmdb/images.ts
@web/lib/services/progress.ts

**Tech stack available:** Next.js 16, Supabase, TMDB API, shadcn/ui
**Established patterns:**
- Show page uses client component for data fetching
- Mark Watched pattern from TitleCard component
- Art-dominant layout with large images
- TMDB API routes under /api/tmdb/*

**Decisions:**
- Tabs for ≤6 seasons, dropdown for more (reuse pattern)
- 16:9 aspect ratio for stills
- Cast photos use profile image helper
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create episode detail page</name>
  <files>web/app/app/show/[id]/season/[seasonNumber]/episode/[episodeNumber]/page.tsx, web/app/app/show/[id]/season/[seasonNumber]/episode/[episodeNumber]/episode-client.tsx</files>
  <action>
1. Create server component page.tsx:
   - Extract id, seasonNumber, episodeNumber from params
   - Render EpisodeClient with showId={parseInt(id)}, seasonNumber={parseInt(seasonNumber)}, episodeNumber={parseInt(episodeNumber)}

2. Create client component episode-client.tsx:
   - Fetch episode details from /api/tmdb/tv/{id}/season/{seasonNumber}/episode/{episodeNumber}
   - Fetch credits from /api/tmdb/tv/{id}/season/{seasonNumber}/episode/{episodeNumber}/credits
   - Fetch show details from /api/tmdb/tv/{id} (for show name in breadcrumb)
   - Use parallel fetching with Promise.all for episode and credits

3. Layout (art-dominant):
   - Large still image at top (use getStillUrl with 'large', fallback to show backdrop)
   - Episode title as h1: "Episode {number}: {name}"
   - Air date in muted text below title
   - Full overview paragraph (no truncation)
   - Runtime if available

4. Cast section:
   - "Main Cast" heading with horizontal scroll of cast cards
   - Each card: profile photo (getProfileUrl), actor name, character name
   - Limit to top 10 by order, show "View All" if more
   - Clicking actor does nothing yet (Phase 9 adds person pages)

5. Guest Stars section:
   - "Guest Stars" heading with horizontal scroll
   - Same card format as main cast
   - Only show section if guest_stars.length > 0

6. Back navigation:
   - Link back to show page: "← Back to {showName}"
  </action>
  <verify>Navigate to /app/show/1399/season/1/episode/1 (Game of Thrones) - page loads with still, title, overview, cast, guest stars</verify>
  <done>Episode detail page displays all episode info with cast and guest stars</done>
</task>

<task type="auto">
  <name>Task 2: Add Mark Watched and wire up navigation</name>
  <files>web/app/app/show/[id]/season/[seasonNumber]/episode/[episodeNumber]/episode-client.tsx, web/components/episode-tile.tsx, web/app/app/show/[id]/show-client.tsx</files>
  <action>
1. In episode-client.tsx, add Mark Watched button:
   - Get current profile from localStorage (same pattern as Tonight view)
   - Fetch tracked_title_id by querying /api/library (check if show is in library)
   - Show "Mark Watched" button only if show is in library AND user has active profile
   - On click: call /api/progress with PUT to set progress to NEXT episode (current + 1)
   - Use optimistic UI pattern: show loading state, then navigate or update
   - After marking watched, show "Marked! Next: S{x}E{y}" briefly

2. In episode-tile.tsx, add onClick navigation:
   - Already has onClick prop
   - No changes needed if parent passes onClick

3. In show-client.tsx, wire up EpisodeTile click:
   - Add router navigation on tile click: router.push(`/app/show/${tmdbId}/season/${seasonNumber}/episode/${episodeNumber}`)
   - Import useRouter from next/navigation
  </action>
  <verify>Click episode tile in grid → navigates to detail page. Mark Watched button appears if logged in with profile and show in library.</verify>
  <done>Full navigation flow works: grid → detail → mark watched</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Episode detail page with cast/guest stars and mark watched functionality</what-built>
  <how-to-verify>
    1. Run: cd web && npm run dev
    2. Navigate to a show page (e.g., /app/show/1399 for Game of Thrones)
    3. Click any episode tile - should navigate to episode detail
    4. Verify episode detail shows:
       - Large still image
       - Episode title and air date
       - Full overview
       - Main Cast section with photos
       - Guest Stars section (if episode has guests)
    5. Verify Mark Watched button (if you have active profile and show in library)
    6. Click back link - returns to show grid
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd web && npm run build` succeeds
- [ ] Episode detail page loads with episode info
- [ ] Cast and guest stars display with photos
- [ ] Navigation from grid to detail works
- [ ] Back navigation works
- [ ] Mark Watched functional (when profile active and show in library)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Episode detail page is art-dominant with large still
- Cast/guest stars display correctly with profile photos
- Mark Watched advances progress
- Phase 8: Episode Detail complete
</success_criteria>

<output>
After completion, create `.planning/phases/08-episode-detail/08-02-SUMMARY.md`
</output>
