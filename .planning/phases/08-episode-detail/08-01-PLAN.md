---
phase: 08-episode-detail
plan: 01
type: execute
---

<objective>
Add TMDB episode credits integration for fetching cast and guest stars.

Purpose: Enable episode detail page to display main cast and guest stars for each episode.
Output: New types, server-side fetch function, and client API route for episode credits.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context (builds directly on these):
@.planning/phases/07-episode-grid/07-01-SUMMARY.md
@.planning/phases/06-progress-tracking/06-02-SUMMARY.md
@.planning/phases/03-tmdb-integration/03-02-SUMMARY.md

# Key files to reference:
@web/lib/tmdb/types.ts
@web/lib/tmdb/details.ts
@web/lib/tmdb/client.ts
@web/lib/tmdb/images.ts
@web/app/api/tmdb/tv/[id]/season/[seasonNumber]/episode/[episodeNumber]/route.ts

**Tech stack available:** Next.js 16, Supabase, TMDB API, shadcn/ui
**Established patterns:**
- TMDB fetch functions return null for 404s
- Client API routes under /api/tmdb/* proxy server-side TMDB calls
- Types defined in web/lib/tmdb/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add episode credits types and fetch function</name>
  <files>web/lib/tmdb/types.ts, web/lib/tmdb/details.ts, web/lib/tmdb/images.ts</files>
  <action>
1. In types.ts, add TMDBCastMember, TMDBCrewMember, TMDBGuestStar, and TMDBEpisodeCredits interfaces:
   - TMDBCastMember: id, name, character, profile_path, order, known_for_department
   - TMDBCrewMember: id, name, job, department, profile_path
   - TMDBGuestStar: id, name, character, profile_path, order
   - TMDBEpisodeCredits: id, cast[], crew[], guest_stars[]

2. In details.ts, add getEpisodeCredits(seriesId, seasonNumber, episodeNumber) function:
   - Calls `/tv/{seriesId}/season/{seasonNumber}/episode/{episodeNumber}/credits`
   - Returns TMDBEpisodeCredits or null on 404
   - Follows same pattern as getTVEpisode

3. In images.ts, add profile image size to TMDB_IMAGE_SIZES and add getProfileUrl helper:
   - profile: { small: 'w45', medium: 'w185', large: 'h632' }
   - getProfileUrl(path, size = 'medium') convenience wrapper
  </action>
  <verify>TypeScript compiles without errors: `cd web && npx tsc --noEmit`</verify>
  <done>Types and fetch function added, getProfileUrl helper available</done>
</task>

<task type="auto">
  <name>Task 2: Add episode credits API route</name>
  <files>web/app/api/tmdb/tv/[id]/season/[seasonNumber]/episode/[episodeNumber]/credits/route.ts</files>
  <action>
Create GET route at /api/tmdb/tv/[id]/season/[seasonNumber]/episode/[episodeNumber]/credits:
- Extract and validate id, seasonNumber, episodeNumber from params
- Call getEpisodeCredits from details.ts
- Return 404 if null, otherwise return JSON response
- Follow exact pattern from existing episode route (same error handling, same param parsing)
  </action>
  <verify>Test with curl: `curl -s http://localhost:3000/api/tmdb/tv/1399/season/1/episode/1/credits | head -c 500` returns cast array</verify>
  <done>Credits API route returns cast, crew, and guest_stars arrays</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd web && npx tsc --noEmit` passes
- [ ] `cd web && npm run build` succeeds
- [ ] Credits API route returns valid JSON with cast/crew/guest_stars
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Episode credits endpoint works with real TMDB data (e.g., Game of Thrones S1E1)
</success_criteria>

<output>
After completion, create `.planning/phases/08-episode-detail/08-01-SUMMARY.md`
</output>
