---
phase: 02-data-model
plan: 05
type: execute
---

<objective>
Create profile management UI for creating, editing, and deleting profiles.

Purpose: Allow household admin to manage family profiles with names, avatars, and maturity levels.
Output: Profile management page with CRUD operations and avatar picker.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-data-model/02-04-PLAN.md

@web/lib/database.types.ts
@web/lib/services/household.ts
@web/components/profile-card.tsx

**Prior plan context:**
- Plan 02-04 creates profile picker and context
- Profile card component exists for reuse

**From PROJECT.md Profiles requirements:**
- Create/edit/delete profiles per household
- Avatar selection and maturity levels (Kids/Teen/Adult)
- Optional PIN lock for admin profile (defer to future - just show field)

**Profile management routes:**
- /app/profiles - List with edit/delete
- /app/profiles/new - Create form
- /app/profiles/[id]/edit - Edit form
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create profile service functions</name>
  <files>web/lib/services/profile.ts</files>
  <action>
    1. Create profile service file
    2. Export createProfile(supabase, data: { name, avatar?, maturity_level, household_id }): creates profile, returns Profile
    3. Export updateProfile(supabase, id, data: { name?, avatar?, maturity_level? }): updates profile
    4. Export deleteProfile(supabase, id): deletes profile
    5. Add validation: name required, maturity_level must be kids/teen/adult
    6. Handle errors with meaningful messages
    7. Use proper TypeScript types
  </action>
  <verify>tsc --noEmit in web/ passes</verify>
  <done>profile.ts exports createProfile, updateProfile, deleteProfile with proper types</done>
</task>

<task type="auto">
  <name>Task 2: Create profile management pages</name>
  <files>web/app/app/profiles/page.tsx, web/app/app/profiles/new/page.tsx, web/app/app/profiles/[id]/edit/page.tsx, web/components/profile-form.tsx</files>
  <action>
    1. Create profile-form.tsx component:
       - Props: profile (optional for edit), onSubmit, onCancel
       - Fields: name (text input), avatar (simple color/emoji picker), maturity_level (select)
       - Use shadcn/ui form components (may need to add Select component)
       - Validation: name required
       - Dark theme styling
    2. Create /app/profiles/page.tsx (list):
       - Server component fetches all household profiles
       - Grid of profile cards with edit/delete buttons
       - "Add Profile" button links to /new
       - Show maturity level badge on each card
       - Confirm dialog before delete
    3. Create /app/profiles/new/page.tsx:
       - ProfileForm in create mode
       - On submit: call createProfile, redirect to /app/profiles
    4. Create /app/profiles/[id]/edit/page.tsx:
       - Fetch profile by ID
       - ProfileForm in edit mode with existing data
       - On submit: call updateProfile, redirect to /app/profiles
       - Delete button with confirmation
    5. Add Select component from shadcn/ui if not present
  </action>
  <verify>npm run build in web/ passes</verify>
  <done>Profile list, create, and edit pages render with working forms</done>
</task>

<task type="auto">
  <name>Task 3: Add navigation links</name>
  <files>web/app/app/profiles/select/page.tsx, web/app/app/page.tsx</files>
  <action>
    1. In profile select page: Add "Manage Profiles" link to /app/profiles
    2. In /app/page.tsx (dashboard): Add link to profile management
    3. Style links consistently with existing navigation
    4. Consider adding to a simple nav or settings area
  </action>
  <verify>npm run dev - can navigate between profile picker, profile list, and profile forms</verify>
  <done>Navigation links connect profile selection and management flows</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete profile management CRUD with forms and navigation</what-built>
  <how-to-verify>
    1. Run: npm run dev (in web/)
    2. Visit: http://localhost:3000/app/profiles
    3. Should see list with "Me" profile (created on signup)
    4. Click "Add Profile"
    5. Fill form with name "Kid", select "kids" maturity, choose avatar
    6. Submit - should redirect to list showing both profiles
    7. Click edit on new profile
    8. Change name to "Child"
    9. Submit - should update in list
    10. Click delete on test profile
    11. Confirm - should remove from list
    12. Navigate to profile picker - should show updated profiles
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Profile service functions work (create, update, delete)
- [ ] Profile list page shows all household profiles
- [ ] Create form adds new profile
- [ ] Edit form updates existing profile
- [ ] Delete removes profile with confirmation
- [ ] Navigation connects all profile-related pages
</verification>

<success_criteria>
- Full CRUD operations work for profiles
- Forms validate input
- Changes reflect immediately in UI
- Phase 2: Data Model complete
</success_criteria>

<output>
After completion, create `.planning/phases/02-data-model/02-05-SUMMARY.md`:

Include "Phase 2 complete, ready for Phase 3: TMDB Integration"
</output>
