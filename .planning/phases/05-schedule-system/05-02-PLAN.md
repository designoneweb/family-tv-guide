---
phase: 05-schedule-system
plan: 02
type: execute
---

<objective>
Build schedule management UI for viewing and editing weekly schedules.

Purpose: Allow users to view their week schedule, add titles from library to specific days, reorder slots, and remove entries.
Output: Schedule page at `/app/schedule` with week grid, add-to-day dialog, drag-reorder or button reorder.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan in this phase:
@.planning/phases/05-schedule-system/05-01-PLAN.md

# UI patterns to follow:
@web/app/app/library/library-client.tsx
@web/components/title-card.tsx

# API routes from 05-01 (will exist):
# GET /api/schedule?profileId=X - Get week schedule
# POST /api/schedule - Add to schedule
# DELETE /api/schedule/[id] - Remove entry
# PATCH /api/schedule/[id] - Reorder/move

**Tech stack available:** Next.js 16, shadcn/ui, Tailwind, React state
**Established patterns:**
- Client component with useEffect fetch
- AlertDialog for confirmations
- Button variants for actions
**Constraining decisions:**
- Per-profile schedules (need ProfileContext)
- TitleCard for consistent display
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create schedule page with week grid display</name>
  <files>web/app/app/schedule/page.tsx, web/app/app/schedule/schedule-client.tsx</files>
  <action>
Create schedule management page:

**page.tsx** (server component):
- Import ProfileGuard wrapper
- Render ScheduleClient within ProfileGuard

**schedule-client.tsx** (client component):
- Use ProfileContext to get current profile ID and household ID
- Fetch week schedule on mount: GET /api/schedule?profileId={profileId}
- Display 7-day grid (horizontal scroll on mobile, grid on desktop):
  - Each day column shows day name (Sun-Sat) at top
  - List of scheduled titles below, ordered by slot_order
  - Each title shows: poster thumbnail (small), title name
  - Remove button (X) on each entry
- Handle remove with confirmation (AlertDialog pattern from library)
- Empty day shows "No shows scheduled" text
- Loading state with spinner
- Error state with message

Day layout:
```
| Sunday | Monday | ... | Saturday |
|--------|--------|-----|----------|
| Title1 | Title2 |     | Title5   |
| Title3 |        |     |          |
```

Use CSS grid: `grid-cols-7` on desktop, horizontal scroll with `flex` + `min-w-[200px]` per day on mobile.
  </action>
  <verify>TypeScript compiles: `cd web && npx tsc --noEmit`</verify>
  <done>Schedule page displays week grid, shows scheduled titles per day, remove works with confirmation</done>
</task>

<task type="auto">
  <name>Task 2: Add title-to-day selection dialog</name>
  <files>web/app/app/schedule/schedule-client.tsx, web/components/add-to-schedule-dialog.tsx</files>
  <action>
Add ability to add library titles to specific days:

**AddToScheduleDialog component** (new file):
- Props: open, onOpenChange, weekday (0-6), householdId, profileId, onAdded callback
- Fetches library titles: GET /api/library (existing endpoint)
- Filters out titles already scheduled for that day (pass existing as prop)
- Shows list of available titles with poster + name
- Click title to add: POST /api/schedule { profileId, trackedTitleId, weekday, householdId }
- Close dialog on success, call onAdded

**schedule-client.tsx updates**:
- Add "+" button at bottom of each day column
- Click opens AddToScheduleDialog for that weekday
- Pass existingTitleIds for that day to filter
- On add success, refetch schedule

Dialog should use shadcn Dialog component (not AlertDialog - this is selection, not confirmation).
Install if needed: `npx shadcn@latest add dialog`
  </action>
  <verify>TypeScript compiles: `cd web && npx tsc --noEmit`</verify>
  <done>Can add titles from library to specific days via dialog, titles refresh after add</done>
</task>

<task type="auto">
  <name>Task 3: Add slot reordering within day</name>
  <files>web/app/app/schedule/schedule-client.tsx</files>
  <action>
Add ability to reorder titles within a day using up/down buttons (simpler than drag-drop):

For each scheduled entry, show:
- Up arrow button (disabled if first in list)
- Down arrow button (disabled if last in list)

On click:
- Swap slot_order with adjacent entry
- Call PATCH /api/schedule/[id] { slotOrder: newPosition } for both entries
- Optimistically update UI, rollback on error

Alternative implementation (if time): Use @dnd-kit for drag-drop, but up/down buttons are MVP-sufficient and simpler.

Add ChevronUp and ChevronDown icons from lucide-react for the buttons.
  </action>
  <verify>TypeScript compiles: `cd web && npx tsc --noEmit`</verify>
  <done>Can reorder titles within a day using up/down buttons, order persists</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Schedule management page with week grid, add-to-day dialog, and reorder controls</what-built>
  <how-to-verify>
    1. Run: `cd web && npm run dev`
    2. Visit: http://localhost:3000/app/schedule (logged in with profile selected)
    3. Verify week grid displays with 7 day columns
    4. Click "+" on a day, verify library titles appear in dialog
    5. Add a title, verify it appears in that day's column
    6. Add another title to same day, verify both show
    7. Use up/down arrows to reorder, verify order changes
    8. Refresh page, verify order persisted
    9. Click remove (X), confirm dialog, verify title removed
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd web && npm run build` succeeds
- [ ] Schedule page displays week grid
- [ ] Can add titles from library to days
- [ ] Can reorder titles within days
- [ ] Can remove titles from schedule
- [ ] All operations persist after refresh
</verification>

<success_criteria>

- Schedule page at /app/schedule shows week view
- Add-to-day dialog works with library filtering
- Reorder with up/down buttons
- Remove with confirmation
- Human verification approved
</success_criteria>

<output>
After completion, create `.planning/phases/05-schedule-system/05-02-SUMMARY.md`
</output>
