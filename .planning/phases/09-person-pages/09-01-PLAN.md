---
phase: 09-person-pages
plan: 01
type: execute
---

<objective>
Add TMDB Person API integration for fetching actor/crew details and filmography.

Purpose: Enable person pages by providing typed data access to TMDB Person endpoints.
Output: Person types, server-side fetch functions, and API routes for client access.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context (establishes patterns):
@.planning/phases/08-episode-detail/08-01-SUMMARY.md

# Existing TMDB patterns to follow:
@web/lib/tmdb/types.ts
@web/lib/tmdb/details.ts
@web/lib/tmdb/client.ts
@web/app/api/tmdb/tv/[id]/route.ts

**Tech stack available:** Next.js 16, TypeScript, TMDB API client with typed fetch
**Established patterns:** tmdbFetch wrapper, null on 404, types in types.ts, functions in details.ts, API routes under /api/tmdb/*

**TMDB Person API Reference (from discovery):**
- GET /person/{person_id} - Returns name, biography, profile_path, known_for_department, birthday, deathday, place_of_birth, also_known_as, popularity
- GET /person/{person_id}/combined_credits - Returns cast[] and crew[] arrays with both TV and movie credits
  - Cast items have: id, media_type, character, name/title, poster_path, vote_average, first_air_date/release_date, episode_count (TV only)
  - Crew items have: id, media_type, job, department, name/title, poster_path, vote_average, first_air_date/release_date
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Person types and fetch functions</name>
  <files>web/lib/tmdb/types.ts, web/lib/tmdb/details.ts</files>
  <action>
  Add to types.ts a new "PERSON TYPES" section after CREDITS TYPES:

  1. TMDBPersonDetails interface:
     - id: number
     - name: string
     - biography: string
     - profile_path: string | null
     - known_for_department: string
     - birthday: string | null
     - deathday: string | null
     - place_of_birth: string | null
     - also_known_as: string[]
     - popularity: number

  2. TMDBPersonCastCredit interface (for combined credits cast array):
     - id: number (the credit id)
     - media_type: 'tv' | 'movie'
     - character: string
     - name?: string (TV show name)
     - title?: string (movie title)
     - poster_path: string | null
     - vote_average: number
     - first_air_date?: string (TV)
     - release_date?: string (movie)
     - episode_count?: number (TV only)

  3. TMDBPersonCrewCredit interface (for combined credits crew array):
     - id: number
     - media_type: 'tv' | 'movie'
     - job: string
     - department: string
     - name?: string (TV)
     - title?: string (movie)
     - poster_path: string | null
     - vote_average: number
     - first_air_date?: string
     - release_date?: string

  4. TMDBPersonCombinedCredits interface:
     - id: number (person id)
     - cast: TMDBPersonCastCredit[]
     - crew: TMDBPersonCrewCredit[]

  Add to details.ts two new functions following existing patterns:

  1. getPersonDetails(personId: number): Promise<TMDBPersonDetails | null>
     - Fetch /person/{person_id} with language=en-US
     - Return null on 404

  2. getPersonCombinedCredits(personId: number): Promise<TMDBPersonCombinedCredits | null>
     - Fetch /person/{person_id}/combined_credits with language=en-US
     - Return null on 404
  </action>
  <verify>TypeScript compiles: cd web && npx tsc --noEmit</verify>
  <done>Types exported from types.ts, functions exported from details.ts, no TS errors</done>
</task>

<task type="auto">
  <name>Task 2: Create Person API routes</name>
  <files>web/app/api/tmdb/person/[id]/route.ts, web/app/api/tmdb/person/[id]/credits/route.ts</files>
  <action>
  Create API routes following existing pattern from tv/[id]/route.ts:

  1. /api/tmdb/person/[id]/route.ts - Person details
     - GET handler extracting id from params
     - Parse id as number, return 400 if invalid
     - Call getPersonDetails(id)
     - Return 404 if null, 200 with JSON if found

  2. /api/tmdb/person/[id]/credits/route.ts - Combined credits
     - Same pattern as above
     - Call getPersonCombinedCredits(id)
     - Return 404 if null, 200 with JSON if found
  </action>
  <verify>
  Start dev server: cd web && npm run dev
  Test endpoints (will need valid person ID - use 1 for George Lucas):
  curl http://localhost:3000/api/tmdb/person/1 | head -c 500
  curl http://localhost:3000/api/tmdb/person/1/credits | head -c 500
  </verify>
  <done>Both API routes return person data for valid IDs, 404 for invalid, 400 for non-numeric</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd web && npx tsc --noEmit` passes
- [ ] `/api/tmdb/person/1` returns George Lucas details with name, biography
- [ ] `/api/tmdb/person/1/credits` returns cast and crew arrays
- [ ] `/api/tmdb/person/999999999` returns 404
</verification>

<success_criteria>

- TMDBPersonDetails, TMDBPersonCastCredit, TMDBPersonCrewCredit, TMDBPersonCombinedCredits types exist
- getPersonDetails and getPersonCombinedCredits functions work
- API routes accessible at /api/tmdb/person/[id] and /api/tmdb/person/[id]/credits
- All verification checks pass
</success_criteria>

<output>
After completion, create `.planning/phases/09-person-pages/09-01-SUMMARY.md` using summary.md template
</output>
