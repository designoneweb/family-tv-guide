---
phase: 10-ai-synopsis
plan: 02
type: execute
---

<objective>
Integrate AI synopsis into the episode detail page with user-initiated generation.

Purpose: Allow users to request AI-generated spoiler-free synopses from the episode detail view.
Output: Episode detail page with "Get AI Synopsis" button that fetches and displays synopsis.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**From Plan 10-01:**
- POST /api/synopsis route available
- Returns { blurb: string, source: 'ai' | 'tmdb_truncate', cached: boolean }

**Key files:**
@web/app/app/show/[id]/season/[seasonNumber]/episode/[episodeNumber]/episode-client.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add AI synopsis section to episode detail page</name>
  <files>web/app/app/show/[id]/season/[seasonNumber]/episode/[episodeNumber]/episode-client.tsx</files>
  <action>
1. Add state for synopsis: const [synopsis, setSynopsis] = useState<{ text: string; source: 'ai' | 'tmdb_truncate' } | null>(null)
2. Add state for loading: const [isFetchingSynopsis, setIsFetchingSynopsis] = useState(false)
3. Add fetchSynopsis async function that:
   - Sets isFetchingSynopsis to true
   - POSTs to /api/synopsis with { showId, showName: showDetails.name, seasonNumber, episodeNumber, episodeName: episode.name, overview: episode.overview }
   - On success, sets synopsis state with { text: data.blurb, source: data.source }
   - Sets isFetchingSynopsis to false in finally block
4. Add UI section below episode overview:
   - If synopsis exists: Show synopsis text in a styled card/box
   - Add small badge indicating source ("AI Generated" or "TMDB Summary")
   - If no synopsis yet: Show "Get AI Synopsis" button (use Sparkles icon from lucide-react)
   - Button shows loading state while fetching
5. Style synopsis box with subtle background (bg-muted/50), rounded corners, italic text for differentiation from TMDB overview
6. Only show synopsis section if episode.overview exists (no point generating synopsis without source material)
  </action>
  <verify>cd web && npm run build succeeds without errors</verify>
  <done>Episode detail page has AI synopsis section with fetch button and display</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>AI synopsis generation flow from episode detail page</what-built>
  <how-to-verify>
    1. Ensure GEMINI_API_KEY is set in .env.local (or test fallback by not setting it)
    2. Run: cd web && npm run dev
    3. Navigate to any TV show in your library
    4. Go to an episode detail page (e.g., /app/show/123/season/1/episode/1)
    5. Scroll to the overview section
    6. Click "Get AI Synopsis" button
    7. Verify:
       - Button shows loading state while fetching
       - Synopsis appears below the TMDB overview
       - Source badge shows "AI Generated" (if API key set) or "TMDB Summary" (fallback)
       - Refreshing page shows synopsis immediately (cached)
    8. Optional: Test without GEMINI_API_KEY to verify fallback to truncated overview
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cd web && npm run build` succeeds without errors
- [ ] Episode detail page shows "Get AI Synopsis" button
- [ ] Synopsis displays with source indicator
- [ ] Loading state works correctly
- [ ] Cached synopses load immediately on page refresh
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Human verification approved
- Phase 10 complete: AI Synopsis feature working end-to-end
</success_criteria>

<output>
After completion, create `.planning/phases/10-ai-synopsis/10-02-SUMMARY.md`
</output>
