---
phase: 01-foundation
plan: 03
type: execute
---

<objective>
Create route group structure with (marketing) and (app) layouts, landing page, login page, and protected route logic.

Purpose: Establish the routing architecture that separates public and authenticated experiences.
Output: Working auth flow - landing page, login, redirect to protected /app routes.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
@.planning/phases/01-foundation/01-02-SUMMARY.md

**From SPEC.md routing structure:**
- (marketing) routes are static/ISR-friendly
- (app) routes are authenticated + dynamic when cookies/session are read

**Landing page requirements:**
- Hero with feature preview
- Feature bullets (Guide by night, Profiles, Episode grids, Cast exploration)
- CTA: Log in button

**Login requirements:**
- Keep simple for MVP: email magic link or password
- Redirect to /app after successful login
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create route groups with layouts</name>
  <files>web/app/(marketing)/layout.tsx, web/app/(marketing)/page.tsx, web/app/(app)/layout.tsx, web/app/(app)/page.tsx</files>
  <action>
1. Restructure web/app/:
   - Move existing page.tsx content aside (it's the Next.js default)
   - Create (marketing)/ route group for public pages
   - Create (app)/ route group for authenticated pages

2. Create web/app/(marketing)/layout.tsx:
   - Simple layout wrapper
   - Could include marketing header/footer later
   - Pass children through

3. Create web/app/(marketing)/page.tsx (landing page):
   - Dark theme hero section with app name "Family TV Guide"
   - Tagline: "What are we watching tonight?"
   - Feature bullets (use simple list for now, can style later):
     - Schedule shows by day of week
     - Track progress per family member
     - Browse episodes with art-forward design
     - Explore cast and filmographies
   - CTA button linking to /login
   - TMDB attribution in footer (required by constraints)

4. Create web/app/(app)/layout.tsx:
   - Server Component that checks auth
   - Use createClient from lib/supabase/server
   - Call supabase.auth.getUser()
   - If no user, redirect to /login
   - If user exists, render children

5. Create web/app/(app)/page.tsx:
   - Simple placeholder: "Welcome to Family TV Guide"
   - Show user email from session
   - Logout button (client component or server action)
   - This becomes the profile picker in Phase 2

6. Delete or update web/app/page.tsx to redirect to /(marketing) or remove if (marketing)/page.tsx handles root.

Note: Route groups with () don't affect URL - / serves (marketing)/page.tsx, /app/* serves (app)/* routes but we need to set up the actual /app path. Actually, let me reconsider...

Correction: The (app) group should map to /app/* URLs. Create:
- web/app/(marketing)/page.tsx → serves /
- web/app/(app)/app/page.tsx → serves /app (or use /app/(app)/page.tsx with different structure)

Actually simpler approach:
- web/app/(marketing)/page.tsx → /
- web/app/app/layout.tsx → /app/* (protected)
- web/app/app/page.tsx → /app

Use /app as actual URL path, not route group magic for the app section.
  </action>
  <verify>npm run dev - visit localhost:3000 shows landing, localhost:3000/app redirects to login if not authenticated</verify>
  <done>Route groups created with proper layouts, landing page at /, protected /app route</done>
</task>

<task type="auto">
  <name>Task 2: Create login page with Supabase Auth</name>
  <files>web/app/login/page.tsx, web/app/auth/callback/route.ts, web/components/login-form.tsx</files>
  <action>
1. Create web/app/login/page.tsx:
   - Server Component wrapper
   - Check if already logged in, redirect to /app if so
   - Render LoginForm client component

2. Create web/components/login-form.tsx (Client Component):
   - "use client" directive
   - Email input field
   - Password input field
   - Sign In button (email/password auth)
   - Sign Up link/toggle (same form, different action)
   - Use createClient from lib/supabase/client
   - On success, redirect to /app using router.push or router.refresh
   - Display error messages on failure
   - Style with shadcn/ui: Install Button and Input components first
     `npx shadcn@latest add button input card`

3. Create web/app/auth/callback/route.ts:
   - Handle OAuth/magic link callbacks (for future use)
   - Exchange code for session
   - Redirect to /app on success, /login?error=... on failure
   - Use createClient from lib/supabase/server

4. Add logout functionality:
   - Create web/app/app/actions.ts with signOut server action
   - Or add logout button as client component that calls supabase.auth.signOut()
  </action>
  <verify>npm run dev - /login page renders with email/password form, no console errors</verify>
  <done>Login page with email/password auth, callback handler, logout capability</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete auth flow: landing page, login, protected routes, logout</what-built>
  <how-to-verify>
    1. Copy web/.env.local.example to web/.env.local
    2. Fill in your Supabase project URL and anon key
    3. Run: cd web && npm run dev
    4. Visit: http://localhost:3000
       - Confirm dark-themed landing page with features and login CTA
    5. Click "Log In" button
       - Confirm redirected to /login with email/password form
    6. Create account or log in with existing Supabase user
       - Confirm redirected to /app after successful auth
    7. Visit http://localhost:3000/app directly while logged in
       - Confirm shows welcome message with your email
    8. Click logout
       - Confirm redirected to landing or login page
    9. Visit http://localhost:3000/app while logged out
       - Confirm redirected to /login
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] Landing page renders at /
- [ ] Login page renders at /login
- [ ] /app redirects to /login when unauthenticated
- [ ] /app shows content when authenticated
- [ ] Logout works and clears session
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Human verified auth flow works end-to-end
- No TypeScript errors
- Phase 1: Foundation complete
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md` with:
- Note that this completes Phase 1
- Ready for Phase 2: Data Model
</output>
